<!DOCTYPE html>
<html>
<head>
  <title>ClearRoute Test Frontend</title>
</head>
<body>
  <h1>ClearRoute API Tester</h1>

  <h2>Register</h2>
  <input id="regName" placeholder="Name">
  <input id="regEmail" placeholder="Email">
  <input id="regPass" placeholder="Password" type="password">
  <button onclick="register()">Register</button>

  <h2>Login</h2>
  <input id="logEmail" placeholder="Email">
  <input id="logPass" placeholder="Password" type="password">
  <button onclick="login()">Login</button>
  <p>Token: <span id="tokenDisplay"></span></p>

  <h2>Get My User Info</h2>
<button onclick="getMyUserInfo()">Fetch My Info</button>


  <h2>Add Vehicle</h2>
  <input id="vehMake" placeholder="Make">
  <input id="vehModel" placeholder="Model">
  <input id="vehHeight" placeholder="Height (m)" type="number" step="0.01">
  <input id="vehWeight" placeholder="Weight (kg)" type="number">
  <input id="vehWidth" placeholder="Width (m)" type="number" step="0.01">

  <button onclick="addVehicle()">Add Vehicle</button>

  <h2>Get Vehicles</h2>
  <button onclick="getVehicles()">Fetch Vehicles</button>

<h2>Edit Vehicle</h2>
<input id="editVehicleId" placeholder="Vehicle ID" type="number">
<input id="editVehicleName" placeholder="Name">
<input id="editVehicleHeight" placeholder="Height (m)" type="number" step="0.01">
<input id="editVehicleWeight" placeholder="Weight (kg)" type="number" step="0.01">
<input id="editVehicleWidth" placeholder="Width (m)" type="number" step="0.01">
<button onclick="editVehicle()">Update Vehicle</button>


  <h2>Delete Vehicle</h2>
<input id="deleteVehicleId" placeholder="Vehicle ID to delete" type="number">
<button onclick="deleteVehicle()">Delete Vehicle</button>

  <h2>Create Route</h2>
  <input id="start" placeholder="Start Location">
  <input id="end" placeholder="End Location">
  <button onclick="createRoute()">Create Route</button>

  <h2>Get Routes</h2>
  <button onclick="getRoutes()">Fetch Routes</button>

  <h2>Raw Output</h2>
  <pre id="output" style="background:#eee; padding:10px;"></pre>
  <h2>Save User Location</h2>
<input id="ulLocationId" placeholder="Location ID">
<input id="ulName" placeholder="Name">
<button onclick="addUserLocation()">Save Location</button>

<h2>Delete User Location</h2>
<input id="ulDeleteLocationId" placeholder="Location ID">
<button onclick="deleteUserLocation()">Delete Location</button>

<h2>Fetch User Locations</h2>
<button onclick="getUserLocations()">Fetch Locations</button>


  <script>
    let apiBase = 'http://localhost:3000'; 
    let token = '';

    function showOutput(data) {
      document.getElementById('output').textContent = JSON.stringify(data, null, 2);
    }

    async function register() {
      const res = await fetch(`${apiBase}/auth/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: document.getElementById('regName').value,
          email: document.getElementById('regEmail').value,
          password: document.getElementById('regPass').value
        })
      });
      const data = await res.json();
      showOutput(data);
    }

    async function login() {
      const res = await fetch(`${apiBase}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: document.getElementById('logEmail').value,
          password: document.getElementById('logPass').value
        })
      });
      const data = await res.json();
      token = data.token;
      document.getElementById('tokenDisplay').textContent = token;
      showOutput(data);
    }

async function addVehicle() {
  const res = await fetch(`${apiBase}/vehicles`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      name: document.getElementById('vehMake').value, // goes into "Name"
      height: parseFloat(document.getElementById('vehHeight').value) || null,
      weightT: parseFloat(document.getElementById('vehWeight').value) || null,  // this must be weightT
      width: parseFloat(document.getElementById('vehWidth').value) || null
    })
  });

  const data = await res.json();
  showOutput(data);
}



    async function getVehicles() {
  try {
    const res = await fetch(`${apiBase}/vehicles`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    if (!res.ok) {
      const error = await res.text();
      throw new Error(`Fetch failed: ${res.status} ${res.statusText} - ${error}`);
    }

    const data = await res.json();
    showOutput(data);
  } catch (err) {
    showOutput({ error: err.message });
  }
}

async function deleteVehicle() {
  const vehicleId = parseInt(document.getElementById('deleteVehicleId').value, 10);
  if (isNaN(vehicleId)) {
    showOutput({ error: 'Please enter a valid vehicle ID' });
    return;
  }

  const res = await fetch(`${apiBase}/vehicles/${vehicleId}`, {
    method: 'DELETE',
    headers: {
      Authorization: `Bearer ${token}`
    }
  });

  if (res.status === 204) {
    showOutput({ message: `Vehicle ${vehicleId} deleted successfully.` });
  } else {
    const err = await res.text();
    showOutput({ error: `Failed to delete vehicle: ${res.status} - ${err}` });
  }
}

async function editVehicle() {
const vehicleId = parseInt(document.getElementById('editVehicleId').value, 10);
  const name = document.getElementById('editVehicleName').value;
  const heightRaw = document.getElementById('editVehicleHeight').value;
  const weightRaw = document.getElementById('editVehicleWeight').value;
  const widthRaw = document.getElementById('editVehicleWidth').value;

  // Parse as float or set to null explicitly
  const height = heightRaw === '' ? null : parseFloat(heightRaw);
  const weightT = weightRaw === '' ? null : parseFloat(weightRaw);
  const width = widthRaw === '' ? null : parseFloat(widthRaw);

  if (isNaN(vehicleId) || !name) {
    showOutput({ error: 'Please enter a valid vehicle ID and name' });
    return;
  }

  const res = await fetch(`${apiBase}/vehicles/${vehicleId}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${token}`
    },
    body: JSON.stringify({ name, height, weightT, width })
  });

  if (res.status === 204) {
    showOutput({ message: `Vehicle ${vehicleId} updated successfully.` });
  } else {
    const err = await res.text();
    showOutput({ error: `Failed to update vehicle: ${res.status} - ${err}` });
  }
}


async function getRoutes() {
  try {
    const res = await fetch(`${apiBase}/routes`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    if (!res.ok) {
      const error = await res.text();
      throw new Error(`Fetch failed: ${res.status} ${res.statusText} - ${error}`);
    }

    const data = await res.json();
    showOutput(data);
  } catch (err) {
    showOutput({ error: err.message });
  }
}
async function addUserLocation() {
  const res = await fetch(`${apiBase}/userlocations`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      locationId: parseInt(document.getElementById('ulLocationId').value, 10),
      name: document.getElementById('ulName').value
    })
  });
  showOutput(await res.json());
}

async function deleteUserLocation() {
  const res = await fetch(`${apiBase}/userlocations`, {
    method: 'DELETE',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      locationId: parseInt(document.getElementById('ulDeleteLocationId').value, 10)
    })
  });
  showOutput({ deleted: res.status });
}

async function getUserLocations() {
  const res = await fetch(`${apiBase}/userlocations`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  showOutput(await res.json());
}

async function getMyUserInfo() {
  const res = await fetch('http://localhost:3000/auth/me', {
    headers: { Authorization: `Bearer ${token}` }
  });

  const data = await res.json();
  showOutput(data);
}



  </script>
</body>
</html>
